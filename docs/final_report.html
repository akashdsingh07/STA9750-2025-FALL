<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Akashdeep Singh">

<title>Final Report 9750 – About Me</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-cec5a0e53abf3ed84780f7624409562e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">About Me</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-1-introduction" id="toc-part-1-introduction" class="nav-link active" data-scroll-target="#part-1-introduction"><span class="header-section-number">1</span> Part 1: Introduction</a>
  <ul class="collapse">
  <li><a href="#overarching-question" id="toc-overarching-question" class="nav-link" data-scroll-target="#overarching-question"><span class="header-section-number">1.1</span> Overarching Question</a></li>
  <li><a href="#specific-questions" id="toc-specific-questions" class="nav-link" data-scroll-target="#specific-questions"><span class="header-section-number">1.2</span> Specific Questions</a></li>
  </ul></li>
  <li><a href="#part-2-data" id="toc-part-2-data" class="nav-link" data-scroll-target="#part-2-data"><span class="header-section-number">2</span> Part 2: Data</a></li>
  <li><a href="#part-3-analysis" id="toc-part-3-analysis" class="nav-link" data-scroll-target="#part-3-analysis"><span class="header-section-number">3</span> Part 3: Analysis</a>
  <ul class="collapse">
  <li><a href="#baseline-projection-accuracy" id="toc-baseline-projection-accuracy" class="nav-link" data-scroll-target="#baseline-projection-accuracy"><span class="header-section-number">3.1</span> Baseline Projection Accuracy</a></li>
  <li><a href="#fantasy-relevant-subset" id="toc-fantasy-relevant-subset" class="nav-link" data-scroll-target="#fantasy-relevant-subset"><span class="header-section-number">3.2</span> Fantasy-Relevant Subset</a></li>
  <li><a href="#volume-and-projection-error" id="toc-volume-and-projection-error" class="nav-link" data-scroll-target="#volume-and-projection-error"><span class="header-section-number">3.3</span> Volume and Projection Error</a></li>
  <li><a href="#risk-variance-and-fantasy-outcomes" id="toc-risk-variance-and-fantasy-outcomes" class="nav-link" data-scroll-target="#risk-variance-and-fantasy-outcomes"><span class="header-section-number">3.4</span> Risk, Variance, and Fantasy Outcomes</a></li>
  </ul></li>
  <li><a href="#part-4-trends-pressure-and-visibility" id="toc-part-4-trends-pressure-and-visibility" class="nav-link" data-scroll-target="#part-4-trends-pressure-and-visibility"><span class="header-section-number">4</span> Part 4: Trends, Pressure, and Visibility</a></li>
  <li><a href="#part-5-limitations-and-possible-improvements" id="toc-part-5-limitations-and-possible-improvements" class="nav-link" data-scroll-target="#part-5-limitations-and-possible-improvements"><span class="header-section-number">5</span> Part 5: Limitations and Possible Improvements</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Final Report 9750</h1>
<p class="subtitle lead">Losing your Fantasy League might not be your fault</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Akashdeep Singh </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<hr>
<section id="part-1-introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Part 1: Introduction</h1>
<p>Fantasy football has long been embedded in sports culture in the United States. From humorous last-place punishments to handcrafted trophies for league champions, fantasy football has evolved from a casual pastime into a serious competitive activity. What was once a niche hobby among dedicated NFL fans has grown into a mainstream cultural phenomenon with millions of participants nationwide.</p>
<p>This cultural relevance is particularly pronounced in the United States, which hosts the largest fantasy football community in the world. According to industry estimates, approximately <strong>30 million Americans participated in fantasy football leagues in 2022 alone</strong>, a number that has continued to grow steadily in recent years. ESPN reported that in 2024, more than <strong>13 million users played fantasy football on ESPN platforms</strong>, marking an all-time record for the company.</p>
<p>These statistics highlight a broader shift in how fans engage with professional sports. Fantasy football is no longer limited to avid sports enthusiasts. Instead, it spans age groups, income levels, and geographic regions. With nearly <strong>one in ten Americans</strong> participating, fantasy football now occupies a cultural and economic space comparable to other major leisure industries.</p>
<p>Beyond entertainment, fantasy sports have taken on increasing economic importance. Industry forecasts project that the <strong>fantasy sports market will be worth approximately $56.36 billion by 2030</strong>, driven by advances in data analytics, mobile accessibility, and integration with legalized sports betting. Since the Supreme Court’s 2018 decision to overturn PASPA, legal sports betting in the United States has expanded rapidly. Annual betting volume has grown from <strong>$1.5 billion in 2018 to nearly $150 billion</strong>, fundamentally changing how fans consume and interact with sports.</p>
<iframe title="U.S. Sports Betting Annual Revenue Growth" src="https://rg.org/charts/States Yearly growth chart/----" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="300" data-external="1">
</iframe>
<p>Fantasy football exists at the intersection of entertainment, analytics, and gambling. While many leagues remain informal, the financial incentives—league entry fees, prize pools, and reputational stakes—are real. As a result, fantasy participants increasingly rely on <strong>weekly player projections</strong> to guide lineup decisions. These projections are presented by fantasy platforms as objective, data-driven estimates of expected performance. However, their reliability is often assumed rather than empirically validated.</p>
<section id="overarching-question" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="overarching-question"><span class="header-section-number">1.1</span> Overarching Question</h2>
<p>Given the financial, emotional, and competitive stakes involved, accuracy in fantasy football projections has never been more important. Most fantasy participants implicitly trust projections as unbiased representations of expected outcomes. This assumption motivates the central research question of this paper:</p>
<p><strong>How accurate are fantasy football projections in predicting actual player performance?</strong></p>
<p>Beyond raw accuracy, this paper also explores whether projection errors exhibit systematic patterns that may disadvantage fantasy managers in ways largely outside of their control.</p>
</section>
<section id="specific-questions" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="specific-questions"><span class="header-section-number">1.2</span> Specific Questions</h2>
<p>To operationalize the overarching question, the analysis focuses on two related research questions:</p>
<ol type="1">
<li><p><strong>Is there systematic bias across skill positions?</strong><br>
Are certain positions more likely to overperform or underperform projections on a consistent basis?</p></li>
<li><p><strong>Does player volume improve projection accuracy?</strong><br>
Are players with higher opportunity volume (targets, carries, attempts) projected more accurately than lower-volume players?</p></li>
</ol>
<hr>
</section>
</section>
<section id="part-2-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Part 2: Data</h1>
<p>The analysis draws from multiple complementary data sources to capture both <strong>actual performance</strong> and <strong>expected performance</strong> for fantasy-relevant NFL players.</p>
<p>The primary source of realized performance data is the <code>nflreadr</code> package in R. This package provides comprehensive weekly and play-by-play player statistics for all NFL seasons, including yardage, touchdowns, receptions, attempts, and fantasy scoring outputs. The consistency and reliability of <code>nflreadr</code> make it well-suited for quantitative evaluation of player outcomes.</p>
<p>Expected performance data were collected from <strong>FantasyPros</strong>, a widely used fantasy football analytics platform. FantasyPros aggregates projections from five major fantasy providers and publishes a consensus estimate for each player-week. These projections reflect what the average fantasy manager encounters when making lineup decisions.</p>
<p>The FantasyPros projections were scraped and merged with <code>nflreadr</code> data to construct a unified dataset covering the <strong>2024 NFL regular season</strong>. All fantasy points were calculated using a <strong>Half-PPR (Points Per Reception)</strong> scoring format, which balances volume-based scoring with touchdown dependence and reflects common league settings.</p>
<p>To explore whether player visibility or public attention influences performance relative to expectations, the analysis also incorporates <strong>Google search trend data</strong> using the <code>gtrends</code> package. Player search interest serves as a proxy for media attention and perceived pressure.</p>
<p>The final dataset consists of <strong>22 variables</strong>, including fantasy points, projected points, positional indicators, volume metrics (targets, carries, attempts), and trend-based features. While not all variables apply uniformly across positions, the dataset captures a broad representation of offensive fantasy production.</p>
<hr>
</section>
<section id="part-3-analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Part 3: Analysis</h1>
<section id="baseline-projection-accuracy" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="baseline-projection-accuracy"><span class="header-section-number">3.1</span> Baseline Projection Accuracy</h2>
<p>Projection accuracy is first evaluated by calculating the difference between <strong>actual fantasy points and projected fantasy points</strong> on a weekly basis. Positive values indicate overperformance, while negative values indicate underperformance relative to projections.</p>
<p>The following table summarizes the distribution of these differences by position:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Position</th>
<th>Min</th>
<th>1st Qu.</th>
<th>Median</th>
<th>Mean</th>
<th>3rd Qu.</th>
<th>Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>QB</td>
<td>-19.64</td>
<td>-4.00</td>
<td>0.14</td>
<td>1.368</td>
<td>5.78</td>
<td>33.44</td>
</tr>
<tr class="even">
<td>TE</td>
<td>-10.70</td>
<td>-1.50</td>
<td>0.00</td>
<td>0.752</td>
<td>2.25</td>
<td>29.72</td>
</tr>
<tr class="odd">
<td>RB</td>
<td>-14.00</td>
<td>-2.20</td>
<td>0.00</td>
<td>1.130</td>
<td>3.50</td>
<td>37.20</td>
</tr>
<tr class="even">
<td>WR</td>
<td>-14.70</td>
<td>-2.10</td>
<td>0.00</td>
<td>1.224</td>
<td>3.40</td>
<td>33.40</td>
</tr>
</tbody>
</table>
<p>At a surface level, projections appear reasonably accurate. Median values close to zero suggest that, in a typical week, projections align closely with realized outcomes. However, the means exceed the medians for all positions, indicating right-skewed distributions driven by occasional extreme performances.</p>
<p>Because fantasy football outcomes are highly sensitive to outliers, the median provides a more reliable measure of projection accuracy than the mean.</p>
</section>
<section id="fantasy-relevant-subset" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="fantasy-relevant-subset"><span class="header-section-number">3.2</span> Fantasy-Relevant Subset</h2>
<p>Fantasy managers do not evaluate all NFL players equally. To better reflect realistic decision-making contexts, the analysis focuses on players typically rostered in standard 12-team leagues:</p>
<ul>
<li>Top 15 quarterbacks<br>
</li>
<li>Top 15 tight ends<br>
</li>
<li>Top 60 running backs<br>
</li>
<li>Top 60 wide receivers</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Position</th>
<th>Min</th>
<th>1st Qu.</th>
<th>Median</th>
<th>Mean</th>
<th>3rd Qu.</th>
<th>Max</th>
<th>Var</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>QB-top15</td>
<td>-17.86</td>
<td>-3.98</td>
<td>1.50</td>
<td>2.568</td>
<td>7.98</td>
<td>33.44</td>
<td>86.36</td>
</tr>
<tr class="even">
<td>TE-top15</td>
<td>-10.70</td>
<td>-3.40</td>
<td>1.60</td>
<td>1.799</td>
<td>5.80</td>
<td>21.20</td>
<td>38.34</td>
</tr>
<tr class="odd">
<td>RB-top60</td>
<td>-14.00</td>
<td>-3.10</td>
<td>0.40</td>
<td>1.622</td>
<td>5.30</td>
<td>37.20</td>
<td>51.65</td>
</tr>
<tr class="even">
<td>WR-top60</td>
<td>-12.70</td>
<td>-3.50</td>
<td>1.10</td>
<td>2.281</td>
<td>6.60</td>
<td>33.40</td>
<td>62.38</td>
</tr>
</tbody>
</table>
<p>Running backs exhibit the lowest median projection error, suggesting relatively stable and predictable production. Tight ends, despite lower variance, display inconsistent alignment between projections and actual outcomes, indicating structural challenges in projecting the position.</p>
</section>
<section id="volume-and-projection-error" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="volume-and-projection-error"><span class="header-section-number">3.3</span> Volume and Projection Error</h2>
<p>To evaluate whether opportunity volume improves projection accuracy, high-volume players were compared against top fantasy scorers:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Position</th>
<th>AVG Score</th>
<th>% of Volume Leaders</th>
<th>% Error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>QB-top15</td>
<td>20.469</td>
<td>100%</td>
<td>7.33%</td>
</tr>
<tr class="even">
<td>TE-top15</td>
<td>9.129</td>
<td>73.33%</td>
<td>17.52%</td>
</tr>
<tr class="odd">
<td>RB-top60</td>
<td>9.630</td>
<td>88.33%</td>
<td>4.15%</td>
</tr>
<tr class="even">
<td>WR-top60</td>
<td>10.138</td>
<td>88.33%</td>
<td>10.85%</td>
</tr>
</tbody>
</table>
<p>Running backs show the strongest relationship between volume and performance, as well as the lowest proportional error. Tight ends, in contrast, show weak alignment between volume and scoring, reinforcing their volatility.</p>
</section>
<section id="risk-variance-and-fantasy-outcomes" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="risk-variance-and-fantasy-outcomes"><span class="header-section-number">3.4</span> Risk, Variance, and Fantasy Outcomes</h2>
<p>From a statistical perspective, fantasy football outcomes are fundamentally driven by variance. Even when projections are unbiased on average, high variance increases the probability of extreme outcomes. Positions with higher volatility introduce greater risk into lineup decisions, particularly in head-to-head formats where weekly outcomes matter more than season-long averages.</p>
<p>Tight ends represent a high-variance, low-mean position, while running backs exhibit lower relative variance and higher predictability. This asymmetry helps explain why fantasy managers often perceive tight end outcomes as “unlucky,” even when making rational decisions.</p>
<hr>
</section>
</section>
<section id="part-4-trends-pressure-and-visibility" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Part 4: Trends, Pressure, and Visibility</h1>
<p>An exploratory extension of the analysis examines whether public attention—proxied by Google search trends—correlates with deviations from projections. The hypothesis is that increased visibility may influence player performance through heightened pressure or motivation.</p>
<p>The results indicate weak and inconsistent relationships between search interest and projection error. While some high-profile players display increased volatility during periods of heightened attention, the overall effect is not statistically meaningful. This suggests that projection inaccuracies are more likely driven by structural modeling limitations rather than behavioral responses to media pressure.</p>
<hr>
</section>
<section id="part-5-limitations-and-possible-improvements" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Part 5: Limitations and Possible Improvements</h1>
<p>Several limitations should be acknowledged. First, the analysis focuses exclusively on a single NFL season. While 2024 provides a rich dataset, multi-season analysis would improve external validity.</p>
<p>Second, projections are treated as fixed benchmarks. In practice, projections evolve throughout the week as injury and weather information becomes available. Future work could incorporate time-adjusted projections.</p>
<p>Potential methodological improvements include:</p>
<ul>
<li>Player-level random effects models<br>
</li>
<li>Injury-adjusted opportunity metrics<br>
</li>
<li>Team context variables such as pace and implied totals</li>
</ul>
<p>Despite these limitations, the results highlight a key insight: <strong>fantasy football outcomes are not solely a function of managerial skill</strong>.</p>
<hr>
</section>
<section id="conclusion" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Conclusion</h1>
<p>Fantasy football is often described as a game of skill. This analysis demonstrates that while skill matters, <strong>projection bias and positional volatility play a significant role</strong> in determining outcomes. Tight end projections are systematically less reliable, while running back projections offer the greatest stability.</p>
<p>For fantasy managers, this implies that losing a matchup—or even an entire league—may not always reflect poor decision-making. In many cases, the numbers simply were not on your side.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/akashdsingh07\.github\.io\/STA9750-2025-FALL");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>